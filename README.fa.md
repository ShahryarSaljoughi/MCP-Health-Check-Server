# سرور مستقل MCP برای بررسی سلامت سرویس‌ها (ASP.NET Core)

[![Difficulty](https://img.shields.io/badge/difficulty-hard-critical)]()
[![Languages](https://img.shields.io/badge/languages-C%23%20%7C%20ASP.NET%20Core-informational)]()
[![Deadline](https://img.shields.io/badge/deadline-2026--01--06-critical)]()

> یک **سرور مستقل MCP** بسازید که به مدل‌های هوش مصنوعی امکان دهد وضعیت سلامت سرویس‌های ابری شما را به‌صورت **استاندارد** و از طریق اینترنت عمومی استعلام کنند — با استفاده از **HTTP + SSE**، چرخه حیات MCP (**Initialize** و **Handshake**)، ابزار `check_api_status` و **مدیریت همزمان چندین کلاینت (Session Management)**.

---

## فهرست مطالب

* [سرور مستقل MCP برای بررسی سلامت سرویس‌ها (ASP.NET Core)](#سرور-مستقل-mcp-برای-بررسی-سلامت-سرویسها-aspnet-core)

  * [فهرست مطالب](#فهرست-مطالب)
  * [پیش‌نیازها](#پیشنیازها)
  * [شرح مسئله](#شرح-مسئله)
  * [قوانین و محدودیت‌ها](#قوانین-و-محدودیتها)
  * [سناریوهای اصلی](#سناریوهای-اصلی)
  * [ورودی/خروجی و مثال‌ها](#ورودیخروجی-و-مثالها)
  * [نحوه اجرا و تست](#نحوه-اجرا-و-تست)

    * [1) کلون پروژه](#1-کلون-پروژه)
    * [2) بیلد و اجرا](#2-بیلد-و-اجرا)
    * [3) اجرای تست‌ها (اختیاری)](#3-اجرای-تستها-اختیاری)
  * [نحوه ارسال (PR)](#نحوه-ارسال-pr)
  * [معیارهای ارزیابی](#معیارهای-ارزیابی)
  * [زمان‌بندی](#زمانبندی)
  * [راه‌های ارتباطی](#راههای-ارتباطی)

---

## پیش‌نیازها

* زبان مجاز: **C#**
* فریم‌ورک: **.NET 8 (پیشنهادی)** / .NET 7 به بالا قابل قبول
* SDK پیشنهادی: **.NET 8.0.x**
* سرور: **ASP.NET Core**
* پروتکل: **HTTP + Server-Sent Events (SSE)** (استفاده از HTTPS توصیه می‌شود)
* سیستم‌عامل: آزاد (Windows / Linux / macOS)
* آشنایی با:

  * APIهای HTTP
  * استریمینگ SSE
  * برنامه‌نویسی async
  * همزمانی و مدیریت وضعیت/سشن

---

## شرح مسئله

سازمان شما قصد دارد این امکان را فراهم کند که مدل‌های هوش مصنوعی (مانند Claude) بتوانند وضعیت سلامت سرویس‌های ابری شما را به‌صورت **مستقیم** و **استاندارد** از طریق اینترنت استعلام کنند.

برای این منظور باید یک **سرور مستقل MCP** با استفاده از **ASP.NET Core** طراحی و پیاده‌سازی کنید که قابلیت‌های زیر را داشته باشد:

1. پیاده‌سازی کامل **چرخه حیات MCP** بر بستر **HTTP/SSE** شامل مراحل **Initialize** و **Handshake**.
2. تعریف یک **ابزار (Tool)** با نام `check_api_status` که یک URL دریافت کرده و وضعیت در دسترس بودن آن را گزارش دهد.
3. پشتیبانی از **چندین کلاینت به‌صورت همزمان** با استفاده از **مدیریت سشن** (ایزوله بودن کامل هر سشن).

> این یک چالش بک‌اند/سروری است: تمرکز روی پیاده‌سازی پروتکل، SSE، اجرای ابزارها و چرخه حیات سشن‌ها.

---

## قوانین و محدودیت‌ها

* **پروتکل و چرخه حیات**

  * مراحل **Initialize** و **Handshake** باید به‌صورت قابل تست از طریق فراخوانی‌های HTTP پیاده‌سازی شوند.
  * رویدادهای SSE باید **وابسته به سشن** بوده و به‌درستی مسیریابی شوند.
  * فرمت پیام‌ها و رویدادهای MCP باید به‌صورت شفاف مستندسازی شوند (حتی اگر ساده‌سازی شده باشند).

* **مدیریت سشن**

  * پشتیبانی از چندین سشن همزمان الزامی است.
  * عدم تداخل: رویدادها و نتایج هر سشن نباید در سشن دیگر ظاهر شوند.
  * مکانیزم پاک‌سازی سشن‌ها (TTL / انقضا) باید پیاده‌سازی و مستند شود.

* **اجرای ابزار**

  * ابزار `check_api_status` باید وضعیت واضحی (مانند `UP` / `DOWN`) همراه با جزئیات مفید برگرداند.
  * خطاهایی مانند timeout، خطای DNS، خطای TLS و URL نامعتبر باید مدیریت شوند (بدون کرش کردن برنامه).

* **ملاحظات امنیتی (الزامی)**

  * محافظت در برابر SSRF به‌صورت پیش‌فرض (مثلاً allowlist دامنه‌ها، مسدودسازی آدرس‌های private/loopback یا سیاست‌های قابل تنظیم).
  * استفاده از timeoutها و محدودیت‌های اندازه درخواست به‌صورت منطقی.

* **وابستگی‌ها**

  * ترجیحاً از کتابخانه‌های استاندارد .NET استفاده شود. در صورت استفاده از پکیج‌های اضافی، دلیل آن باید مستند شود.

---

## سناریوهای اصلی

### 1) Initialize (HTTP)

کلاینت یک سشن جدید MCP ایجاد می‌کند.

**انتظارات از سرور:**

* ایجاد و ذخیره یک `session_id` جدید.
* بازگرداندن اطلاعات پروتکل و قابلیت‌ها.
* بازگرداندن لیست ابزارهای در دسترس (حداقل شامل `check_api_status`).
* ارائه آدرس SSE مربوط به همان سشن.

### 2) Handshake (HTTP + SSE)

کلاینت فرآیند handshake را تکمیل کرده و به استریم SSE متصل می‌شود.

**انتظارات از سرور:**

* اعتبارسنجی `session_id`.
* باز و نگه‌داشتن اتصال SSE.
* ارسال رویدادهای handshake/ready برای تأیید فعال بودن سشن.

### 3) فراخوانی ابزار: `check_api_status`

کلاینت درخواست اجرای ابزار را با ورودی زیر ارسال می‌کند:

* `name`: `check_api_status`
* `input`: `{ "url": "https://example.com/health" }`

**انتظارات از سرور:**

* انجام یک درخواست HTTP برای بررسی وضعیت.
* گزارش موارد زیر:

  * وضعیت (`UP` / `DOWN`)
  * کد وضعیت HTTP (در صورت دسترس‌پذیری)
  * زمان پاسخ (میلی‌ثانیه)
  * زمان بررسی
  * جزئیات خطا (در صورت شکست)

### 4) چندین کلاینت / سشن

سرور باید توانایی پشتیبانی همزمان از چندین کلاینت را داشته باشد.

**انتظارات از سرور:**

* مسیریابی صحیح رویدادهای SSE و نتایج ابزارها برای هر سشن.
* ذخیره‌سازی thread-safe سشن‌ها.
* پاک‌سازی سشن‌های منقضی‌شده.

---

## ورودی/خروجی و مثال‌ها

### تعریف ابزار (الزامی)

**نام ابزار:** `check_api_status`

**رفتار پیش‌فرض:**

* timeout پیش‌فرض بررسی: **3000 میلی‌ثانیه** (باید قابل تنظیم باشد).

**ورودی JSON مورد انتظار:**

```json
{
  "url": "https://example.com/health"
}
```

**خروجی موفق پیشنهادی:**

```json
{
  "url": "https://example.com/health",
  "status": "UP",
  "http_status": 200,
  "latency_ms": 87,
  "checked_at": "2025-12-30T12:00:00Z"
}
```

**خروجی ناموفق پیشنهادی:**

```json
{
  "url": "https://example.com/health",
  "status": "DOWN",
  "error": "Timeout after 3000ms",
  "checked_at": "2025-12-30T12:00:00Z"
}
```

---

## نحوه اجرا و تست

### 1) کلون پروژه

```bash
git clone https://github.com/dotin-challenge/MCP-Health-Check-Server.git
cd MCP-Health-Check-Server
```

### 2) بیلد و اجرا

```bash
dotnet restore
dotnet build
dotnet run --project src/McpHealthServer
```

### 3) اجرای تست‌ها (اختیاری)

```bash
dotnet test
```

**حداقل تست‌های مورد انتظار:**

* بازگشت `session_id` و ابزارها در Initialize
* اتصال SSE به سشن و ارسال handshake/ready
* عملکرد صحیح `check_api_status` برای حالت UP/DOWN
* عدم تداخل پاسخ‌ها در دو سشن موازی

---

## نحوه ارسال (PR)

1. ریپو را **Fork** کنید.

2. یک برنچ جدید بسازید:

   ```bash
   git checkout -b solution/<username>
   ```

3. راه‌حل خود را در مسیر زیر قرار دهید:

   ```text
   solutions/C#/<username>/
     ├── src/...
     ├── tests/...
     └── README.md (اختیاری: توضیحات معماری)
   ```

4. یک Pull Request با عنوان زیر باز کنید:

   ```text
   [Solution] Standalone MCP Health Check Server - <username>
   ```

---

## معیارهای ارزیابی

| معیار                                             | درصد    |
| ------------------------------------------------- | ------- |
| درستی عملکرد (جریان کامل + ابزار)                 | 35%     |
| کیفیت کد (ساختار، خوانایی، SOLID)                 | 15%     |
| تطابق با چرخه حیات MCP (Initialize/Handshake/SSE) | 15%     |
| همزمانی و مدیریت سشن                              | 15%     |
| پایش‌پذیری و امنیت (لاگ، SSRF)                    | 5%      |
| مستندسازی (اندپوینت‌ها + راهنما)                  | 5%      |
| **کیفیت تحویل (قابل اجرا بودن، ریپوی تمیز)**      | **10%** |

---

## زمان‌بندی

* شروع: `2025-12-30`
* مهلت ارسال PR: `2026-01-06`

---

## راه‌های ارتباطی

* برای پرسش‌ها و شفاف‌سازی‌ها از **GitHub Issues** این ریپو استفاده کنید.
